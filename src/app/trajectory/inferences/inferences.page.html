<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        [text]="'general.back' | translate"
        defaultHref="/"
      ></ion-back-button>
    </ion-buttons>
    <ion-title> {{ 'trajectory.insights.title' | translate }} </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="!hasInferences" class="centered ion-padding">
    <div>{{ 'trajectory.insights.noInferences' | translate }}</div>
    <div>
      <a (click)="openMap()"
        >{{ 'trajectory.insights.lookAtMapLink' | translate }}</a
      >
    </div>
  </div>

  <ion-list *ngIf="hasInferences">
    <ion-card *ngFor="let key of inferences.keys()">
      <ion-card-header>
        <ion-card-title class="inference-card-title">
          <ion-icon [name]="getInferenceTypeIcon(key)"></ion-icon>
          <h5>{{ 'inference.info.' + key + 'Title' | translate }}</h5>
        </ion-card-title>
        <ion-card-subtitle>
          {{ 'inference.info.' + key + 'Subtitle' | translate }}
        </ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <ion-list lines="none">
          <ion-item
            *ngFor="let i of inferences.get(key).primaryInferences"
            class="primary-inference-item"
            button
            detail="true"
            detail-icon="map-outline"
            (click)="showInferenceOnMap(i)"
          >
            <ion-icon
              *ngIf="i.type !== 'poi'"
              slot="start"
              size="small"
              name="ellipse"
              [color]="getInferenceRatingColor(i)"
            ></ion-icon>
            <ion-icon
              *ngIf="i.type === 'poi' && i.geocoding"
              slot="start"
              size="small"
              [name]="getInferencePoiIcon(i)"
            ></ion-icon>
            <ion-label class="ion-text-wrap">
              <p>{{ i.addressDisplayName }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>

      <ion-accordion-group
        *ngIf="inferences.get(key).secondaryInferences.length > 0"
      >
        <div class="divider"></div>
        <ion-accordion value="first">
          <ion-item slot="header" class="accordion-header">
            <ion-label>
              {{ 'inference.info.moreInferences' | translate }}
            </ion-label>
          </ion-item>
          <div class="ion-padding accordion-content" slot="content">
            <ion-list lines="none">
              <ion-item
                *ngFor="let i of inferences.get(key).secondaryInferences"
                button
                detail="true"
                detail-icon="map-outline"
                (click)="showInferenceOnMap(i)"
              >
                <ion-icon
                  *ngIf="i.type !== 'poi'"
                  slot="start"
                  size="small"
                  name="ellipse"
                  [color]="getInferenceRatingColor(i)"
                ></ion-icon>
                <ion-icon
                  *ngIf="i.type === 'poi'"
                  slot="start"
                  size="small"
                  [name]="getInferencePoiIcon(i)"
                ></ion-icon>
                <ion-label class="ion-text-wrap">
                  <p>{{ i.addressDisplayName }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ion-card>
  </ion-list>
</ion-content>
